# 01-cron表达式原理与使用

有5个*符号，分别代表的含义是：

   *        *        *       *        *       Command
分(0-59) 时(0-23) 日(1-31) 月(1-12) 星期(0-7)   Shell命令

cron表达式是没有年的，这里星期是0-7, 按照美国人的习惯，0和7都是星期日，所以都是可以的

`*/5 * * * * echo hello > /tmp/x.log`这条命令的含义是每隔五分钟，执行一次，第一个*表示每分钟，`*/5`表示每隔5分钟，而且需要注意的是，命令的执行并不是依据这条命令的执行时间来算的，而是每个小时的5, 10, 15, 25...分钟的时候执行

常见用法：
- 每五分钟执行1次：`*/5 * * * * echo hello > /tmp/x.log`
- 第1-5分钟，执行5次：`1-5 * * * * /usr/bin/python /data/x.py`
- 每天10点,22点执行一次：`0 10,22 * * * echo bye | tail -l`

## 如何通过程序计算出下次调度的时间

例如：已知当前Unix时间为1548046800，即：2019-01-21 13:40，已知cron表达式是30 * * * *，计算命令下次调度的时间：

通过人脑分析，很容易知道下次调度的时间是2019-01-21 14:30，但是如何通过程序算出？

首先把cron表达式做一个枚举：

| 粒度       |     可枚举的值    | cron代表的值 |
| :-------- |    --------:    |  :------:   |
| 分钟       |    30           |     30     |
| 小时       | 0, 1, 2, ... 23 |      *     |
| 日期       | 1, 2, 3, ... 31 |      *     |
| 月份       | 1, 2, 3, ... 12 |      *     |

为了简化问题，暂时只考虑时间的 40分 13时 21日，从大到小判断，先判断21日是否在可枚举范围内，说明当前日期是符合cron要求的，所以判断小时，13时也在可枚举范围内，判断分钟，分钟不在枚举范围之内，并且大于枚举值，程序就把更大的粒度单位向后挪一下，把小时移向下一个小时，13时变成14时，分钟置0，再次判断分钟，发现分钟小于枚举值，所以就把00分置为30分

## 开源库cronexpr库

常用的有两个api：
- Parse(): 解析与校验Cron表达式（判断是否合法）
- Next(): 根据当前时间，计算下次调度时间
